// https://d3js.org/d3-zoom/ Version 1.0.1. Copyright 2016 Mike Bostock.
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-dispatch"),require("d3-drag"),require("d3-interpolate"),require("d3-selection"),require("d3-transition")):"function"==typeof define&&define.amd?define(["exports","d3-dispatch","d3-drag","d3-interpolate","d3-selection","d3-transition"],n):n(t.d3=t.d3||{},t.d3,t.d3,t.d3,t.d3,t.d3)}(this,function(t,n,e,o,i,r){"use strict";function u(t){return function(){return t}}function h(t,n,e){this.target=t,this.type=n,this.transform=e}function s(t,n,e){this.k=t,this.x=n,this.y=e}function c(t){return t.__zoom||v}function a(){i.event.stopImmediatePropagation()}function f(){i.event.preventDefault(),i.event.stopImmediatePropagation()}function l(){return!i.event.button}function p(){var t,n,e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,t=e.width.baseVal.value,n=e.height.baseVal.value):(t=e.clientWidth,n=e.clientHeight),[[0,0],[t,n]]}function m(){return this.__zoom||v}function d(){function t(t){t.on("wheel.zoom",g).on("mousedown.zoom",k).on("dblclick.zoom",w).on("touchstart.zoom",M).on("touchmove.zoom",T).on("touchend.zoom touchcancel.zoom",b).style("-webkit-tap-highlight-color","rgba(0,0,0,0)").property("__zoom",m)}function c(t,n){return n=Math.max(j,Math.min(B,n)),n===t.k?t:new s(n,t.x,t.y)}function d(t,n,e){var o=n[0]-e[0]*t.k,i=n[1]-e[1]*t.k;return o===t.x&&i===t.y?t:new s(t.k,o,i)}function v(t,n){var e=Math.min(0,t.invertX(n[0][0])-D)||Math.max(0,t.invertX(n[1][0])-G),o=Math.min(0,t.invertY(n[0][1])-H)||Math.max(0,t.invertY(n[1][1])-K);return e||o?t.translate(e,o):t}function y(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function z(t,n,e){t.on("start.zoom",function(){_(this,arguments).start()}).on("interrupt.zoom end.zoom",function(){_(this,arguments).end()}).tween("zoom",function(){var t=this,i=arguments,r=_(t,i),u=S.apply(t,i),h=e||y(u),c=Math.max(u[1][0]-u[0][0],u[1][1]-u[0][1]),a=t.__zoom,f="function"==typeof n?n.apply(t,i):n,l=o.interpolateZoom(a.invert(h).concat(c/a.k),f.invert(h).concat(c/f.k));return function(t){if(1===t)t=f;else{var n=l(t),e=c/n[2];t=new s(e,h[0]-n[0]*e,h[1]-n[1]*e)}r.zoom(null,t)}})}function _(t,n){for(var e,o=0,i=W.length;o<i;++o)if((e=W[o]).that===t)return e;return new x(t,n)}function x(t,n){this.that=t,this.args=n,this.index=-1,this.active=0}function g(){function t(){I=null,n.end()}if(P.apply(this,arguments)){var n=_(this,arguments),e=this.__zoom,o=Math.max(j,Math.min(B,e.k*Math.pow(2,-i.event.deltaY*(i.event.deltaMode?120:1)/500)));if(I){var u=i.mouse(this);q[0]===u[0]&&q[1]===u[1]||(E=e.invert(q=u)),clearTimeout(I)}else{if(e.k===o)return;n.extent=S.apply(this,arguments),E=e.invert(q=i.mouse(this)),r.interrupt(this),n.start()}f(),I=setTimeout(t,C),n.zoom("mouse",v(d(c(e,o),q,E),n.extent))}}function k(){function t(){f(),Y=!0,o.zoom("mouse",v(d(o.that.__zoom,q=i.mouse(o.that),E),o.extent))}function n(){u.on("mousemove.zoom mouseup.zoom",null),e.dragEnable(i.event.view,Y),f(),o.end()}if(!V&&P.apply(this,arguments)){var o=_(this,arguments),u=i.select(i.event.view).on("mousemove.zoom",t,!0).on("mouseup.zoom",n,!0);e.dragDisable(i.event.view),a(),Y=!1,o.extent=S.apply(this,arguments),E=this.__zoom.invert(q=i.mouse(this)),r.interrupt(this),o.start()}}function w(){if(P.apply(this,arguments)){var n=this.__zoom,e=i.mouse(this),o=n.invert(e),r=n.k*(i.event.shiftKey?.5:2),u=v(d(c(n,r),e,o),S.apply(this,arguments));f(),O>0?i.select(this).transition().duration(O).call(z,u,e):i.select(this).call(t.transform,u)}}function M(){if(P.apply(this,arguments)){var t,n,e,o=_(this,arguments),u=i.event.changedTouches,h=u.length;for(a(),t=0;t<h;++t)n=u[t],e=i.touch(this,u,n.identifier),e=[e,this.__zoom.invert(e),n.identifier],o.touch0?o.touch1||(o.touch1=e):o.touch0=e;return X&&(X=clearTimeout(X),!o.touch1)?(o.end(),w.apply(this,arguments)):void(i.event.touches.length===h&&(X=setTimeout(function(){X=null},A),r.interrupt(this),o.extent=S.apply(this,arguments),o.start()))}}function T(){var t,n,e,o,r=_(this,arguments),u=i.event.changedTouches,h=u.length;for(f(),X&&(X=clearTimeout(X)),t=0;t<h;++t)n=u[t],e=i.touch(this,u,n.identifier),r.touch0&&r.touch0[2]===n.identifier?r.touch0[0]=e:r.touch1&&r.touch1[2]===n.identifier&&(r.touch1[0]=e);if(n=r.that.__zoom,r.touch1){var s=r.touch0[0],a=r.touch0[1],l=r.touch1[0],p=r.touch1[1],m=(m=l[0]-s[0])*m+(m=l[1]-s[1])*m,y=(y=p[0]-a[0])*y+(y=p[1]-a[1])*y;n=c(n,Math.sqrt(m/y)),e=[(s[0]+l[0])/2,(s[1]+l[1])/2],o=[(a[0]+p[0])/2,(a[1]+p[1])/2]}else{if(!r.touch0)return;e=r.touch0[0],o=r.touch0[1]}r.zoom("touch",v(d(n,e,o),r.extent))}function b(){var t,n,e=_(this,arguments),o=i.event.changedTouches,r=o.length;for(a(),V&&clearTimeout(V),V=setTimeout(function(){V=null},A),t=0;t<r;++t)n=o[t],e.touch0&&e.touch0[2]===n.identifier?delete e.touch0:e.touch1&&e.touch1[2]===n.identifier&&delete e.touch1;e.touch1&&!e.touch0&&(e.touch0=e.touch1,delete e.touch1),e.touch0||e.end()}var Y,q,E,X,V,I,P=l,S=p,j=0,B=1/0,D=-B,G=B,H=D,K=G,O=250,W=[],Z=n.dispatch("start","zoom","end"),A=500,C=150;return t.transform=function(t,n){var e=t.selection?t.selection():t;e.property("__zoom",m),t!==e?z(t,n):e.interrupt().each(function(){_(this,arguments).start().zoom(null,"function"==typeof n?n.apply(this,arguments):n).end()})},t.scaleBy=function(n,e){t.scaleTo(n,function(){var t=this.__zoom.k,n="function"==typeof e?e.apply(this,arguments):e;return t*n})},t.scaleTo=function(n,e){t.transform(n,function(){var t=S.apply(this,arguments),n=this.__zoom,o=y(t),i=n.invert(o),r="function"==typeof e?e.apply(this,arguments):e;return v(d(c(n,r),o,i),t)})},t.translateBy=function(n,e,o){t.transform(n,function(){return v(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof o?o.apply(this,arguments):o),S.apply(this,arguments))})},x.prototype={start:function(){return 1===++this.active&&(this.index=W.push(this)-1,this.emit("start")),this},zoom:function(t,n){return q&&"mouse"!==t&&(E=n.invert(q)),this.touch0&&"touch"!==t&&(this.touch0[1]=n.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=n.invert(this.touch1[0])),this.that.__zoom=n,this.emit("zoom"),this},end:function(){return 0===--this.active&&(W.splice(this.index,1),q=E=null,this.index=-1,this.emit("end")),this},emit:function(n){i.customEvent(new h(t,n,this.that.__zoom),Z.apply,Z,[n,this.that,this.args])}},t.filter=function(n){return arguments.length?(P="function"==typeof n?n:u(!!n),t):P},t.extent=function(n){return arguments.length?(S="function"==typeof n?n:u([[+n[0][0],+n[0][1]],[+n[1][0],+n[1][1]]]),t):S},t.scaleExtent=function(n){return arguments.length?(j=+n[0],B=+n[1],t):[j,B]},t.translateExtent=function(n){return arguments.length?(D=+n[0][0],G=+n[1][0],H=+n[0][1],K=+n[1][1],t):[[D,H],[G,K]]},t.duration=function(n){return arguments.length?(O=+n,t):O},t.on=function(){var n=Z.on.apply(Z,arguments);return n===Z?t:n},t}s.prototype={constructor:s,scale:function(t){return 1===t?this:new s(this.k*t,this.x,this.y)},translate:function(t,n){return 0===t&0===n?this:new s(this.k,this.x+this.k*t,this.y+this.k*n)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var v=new s(1,0,0);c.prototype=s.prototype,t.zoom=d,t.zoomTransform=c,t.zoomIdentity=v,Object.defineProperty(t,"__esModule",{value:!0})});